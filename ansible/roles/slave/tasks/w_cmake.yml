---
- name: cmake | Installed?
  win_stat:
    path: "C:\\Program Files (x86)\\CMake"
  register: app

- name: Download file
  win_get_url:
    url: "file://{{ cache_location }}\\{{ file }}"
    dest: "{{ download_location }}\\{{ file }}"
  when: not app.stat.exists

- name: cmake | Install
  win_package:
    name: git
    path: "{{ download_location }}\\{{ file }}"
    product_id: "CMake 3.4.1"
    arguments: "/S"
  when: not app.stat.exists

- name: cmake | Delete local file
  win_file:
    path: "{{ download_location }}\\{{ file }}"
    state: absent
  when: not app.stat.exists

- include: win_path.yml
  vars:
    path: 'C:\Program Files (x86)\CMake\bin'
    level: machine
